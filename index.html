<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIDA API Authentication</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for Inter font and rounded corners */
        body {
            font-family: 'Inter', sans-serif;
        }
        .rounded-elements * {
            border-radius: 0.5rem; /* Apply rounded corners to child elements */
        }
        /* Define custom colors for Tailwind */
        :root {
            --color-vida-navy: #0A2E50; /* A deep navy */
            --color-vida-green: #00B050; /* A vibrant green */
            --color-vida-green-dark: #008F40; /* A darker green for hover */
            --color-vida-white: #FFFFFF; /* Pure white */
            --color-vida-light-gray: #F8F8F8; /* Very light gray for background */
            --color-vida-dark-text: #333333; /* Dark gray for general text */
            --color-vida-code-bg: #1A202C; /* Dark background for code block */
            --color-vida-code-text: #68D391; /* Light green for code text */
        }

        .bg-vida-navy { background-color: var(--color-vida-navy); }
        .text-vida-navy { color: var(--color-vida-navy); }
        .bg-vida-green { background-color: var(--color-vida-green); }
        .hover\:bg-vida-green-dark:hover { background-color: var(--color-vida-green-dark); }
        .text-vida-green { color: var(--color-vida-green); }
        .focus\:ring-vida-green:focus { --tw-ring-color: var(--color-vida-green); }
        .bg-vida-light-gray { background-color: var(--color-vida-light-gray); }
        .text-vida-dark-text { color: var(--color-dark-text); }
        .bg-vida-code-bg { background-color: var(--color-vida-code-bg); }
        .text-vida-code-text { color: var(--color-vida-code-text); }
        .border-vida-green { border-color: var(--color-vida-green); }
        .focus\:border-vida-green:focus { border-color: var(--color-vida-green); }
    </style>
</head>
<body class="bg-vida-light-gray min-h-screen flex items-center justify-center p-4">
    <div class="bg-vida-white shadow-xl rounded-xl p-8 max-w-4xl w-full flex flex-col gap-8 rounded-elements">
        <h1 class="text-3xl font-bold text-vida-navy text-center mb-6">VIDA API Authentication</h1>

        <div class="flex flex-col md:flex-row gap-8">
            <!-- Left Part: Input Fields -->
            <div class="flex-1 flex flex-col p-6 bg-vida-light-gray rounded-lg shadow-md">
                <h2 class="text-2xl font-bold text-vida-navy mb-6">Client Credentials</h2>

                <div class="mb-4">
                    <label for="clientId" class="block text-lg font-medium text-vida-dark-text mb-2">Client ID:</label>
                    <input type="text" id="clientId" class="w-full text-gray-900 bg-white border border-gray-300 rounded-lg p-2.5 focus:outline-none focus:ring-2 focus:ring-vida-green focus:border-vida-green" placeholder="Enter your Client ID">
                </div>

                <div class="mb-6">
                    <label for="clientSecret" class="block text-lg font-medium text-vida-dark-text mb-2">Client Secret:</label>
                    <input type="password" id="clientSecret" class="w-full text-gray-900 bg-white border border-gray-300 rounded-lg p-2.5 focus:outline-none focus:ring-2 focus:ring-vida-green focus:border-vida-green" placeholder="Enter your Client Secret">
                </div>

                <button id="authenticateButton" class="w-full bg-vida-green hover:bg-vida-green-dark text-white font-semibold py-3 px-6 rounded-lg transition duration-300 ease-in-out shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-vida-green focus:ring-offset-2">
                    Get Access Token
                </button>
            </div>

            <!-- Right Part: API Response Display -->
            <div class="flex-1 flex flex-col p-6 bg-vida-light-gray rounded-lg shadow-md">
                <h2 class="text-2xl font-bold text-vida-navy mb-6">API Response</h2>

                <div id="loadingIndicator" class="hidden text-center text-vida-green font-medium mb-4">
                    Authenticating...
                </div>

                <pre id="apiResponse" class="flex-grow bg-vida-code-bg text-vida-code-text p-4 rounded-lg overflow-auto text-sm whitespace-pre-wrap leading-relaxed shadow-inner">
                    <code class="language-json">
                        {
    "message": "Enter Client ID and Client Secret, then click 'Get Access Token'.",
    "instructions": "The access token will appear here."
}
                    </code>
                </pre>

                <!-- Custom Modal for Alerts -->
                <div id="customAlertDialog" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50">
                    <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
                        <h3 id="alertDialogTitle" class="text-xl font-bold text-vida-navy mb-4"></h3>
                        <p id="alertDialogMessage" class="text-vida-dark-text mb-6"></p>
                        <button id="alertDialogCloseButton" class="w-full bg-vida-green hover:bg-vida-green-dark text-white font-semibold py-2.5 rounded-lg transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-vida-green focus:ring-offset-2">
                            OK
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Get references to DOM elements
        const clientIdInput = document.getElementById('clientId');
        const clientSecretInput = document.getElementById('clientSecret');
        const authenticateButton = document.getElementById('authenticateButton');
        const apiResponse = document.getElementById('apiResponse');
        const loadingIndicator = document.getElementById('loadingIndicator');

        // Custom alert dialog elements
        const customAlertDialog = document.getElementById('customAlertDialog');
        const alertDialogTitle = document.getElementById('alertDialogTitle');
        const alertDialogMessage = document.getElementById('alertDialogMessage');
        const alertDialogCloseButton = document.getElementById('alertDialogCloseButton');

        // Function to show custom alert dialog
        function showCustomAlert(title, message) {
            alertDialogTitle.textContent = title;
            alertDialogMessage.textContent = message;
            customAlertDialog.classList.remove('hidden');
        }

        // Event listener for closing the custom alert
        alertDialogCloseButton.addEventListener('click', () => {
            customAlertDialog.classList.add('hidden');
        });

        // Event listener for authentication button click
        authenticateButton.addEventListener('click', async function() {
            const clientId = clientIdInput.value.trim();
            const clientSecret = clientSecretInput.value.trim();

            if (!clientId || !clientSecret) {
                showCustomAlert('Missing Credentials', 'Please enter both Client ID and Client Secret.');
                return;
            }

            loadingIndicator.classList.remove('hidden'); // Show loading indicator
            apiResponse.innerHTML = `<code class="language-json">Authenticating...</code>`; // Clear previous response

            try {
                // Call the Netlify Function endpoint
                const proxyUrl = '/.netlify/functions/authenticate'; // This is the endpoint for your Netlify Function

                const response = await fetch(proxyUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json' // Send as JSON to the Netlify Function
                    },
                    body: JSON.stringify({ clientId, clientSecret }) // Send client credentials as JSON
                });

                if (!response.ok) {
                    // Netlify Function or VIDA API returned an error
                    let errorDetails = `HTTP Status: ${response.status}`;
                    try {
                        const errorData = await response.json();
                        errorDetails = errorData.error || JSON.stringify(errorData, null, 2); // Netlify Function error format
                    } catch (parseError) {
                        errorDetails = response.statusText;
                    }
                    throw new Error(`Authentication request failed: ${errorDetails}`);
                }

                const data = await response.json();
                apiResponse.innerHTML = `<code class="language-json">${JSON.stringify(data, null, 2)}</code>`;
                // You can store the access token (data.access_token) here for future API calls
                // console.log("Access Token:", data.access_token);
            } catch (error) {
                let errorMessage = `Error: ${error.message}`;
                showCustomAlert('Authentication Error', errorMessage);
                apiResponse.innerHTML = `<code class="language-json">
                    {
                        "error": "Authentication Failed",
                        "details": "${errorMessage}"
                    }
                </code>`;
            } finally {
                loadingIndicator.classList.add('hidden'); // Hide loading indicator
            }
        });
    </script>
</body>
</html>


